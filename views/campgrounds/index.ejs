<% layout('layouts/boilerplate') %>

<!-- -----------------------------------------------------
     Cluster Map Section
     Displays all campground locations with clustering.
------------------------------------------------------ -->
<div id="cluster-map" style="width: 100%; height: 500px;"></div>


<!-- -----------------------------------------------------
     Campgrounds List Section
------------------------------------------------------ -->
<div class="container">
  <h1>All Campgrounds</h1>

  <% for (let campground of campgrounds) { %>
    <div class="card mb-3">

      <div class="row">

        <!-- Campground Image -->
        <div class="col-md-4">
          <% if (campground.images.length) { %>

            <!-- Show first uploaded image -->
            <img class="img-fluid" 
                 alt="Campground Image" 
                 src="<%= campground.images[0].url %>">

          <% } else { %>

            <!-- Fallback default image -->
            <img class="img-fluid"
                 alt="Default Campground Image"
                 src="https://res.cloudinary.com/douqbebwk/image/upload/v1600103881/YelpCamp/lz8jjv2gyynjil7lswf4.png">

          <% } %>
        </div>


        <!-- Campground Details -->
        <div class="col-md-8">
          <div class="card-body">

            <h5 class="card-title">
              <%= campground.title %>
            </h5>

            <p class="card-text">
              <%= campground.description %>
            </p>

            <p class="card-text">
              <small class="text-muted">
                <%= campground.location %>
              </small>
            </p>

            <!-- View Button -->
            <a class="btn btn-primary" href="/campgrounds/<%= campground._id %>">
              View <%= campground.title %>
            </a>

          </div>
        </div>

      </div>

    </div>
  <% } %>

</div>


<!-- -----------------------------------------------------
     MapTiler + Campground JSON for clusterMap.js
------------------------------------------------------ -->
<script>
  // API key for MapTiler SDK (injected from server)
  const mapToken = <%- JSON.stringify(mapTilerKey) %>;

  // All campground data â€” used by clusterMap.js to create GeoJSON
  const campgroundsData = <%- JSON.stringify(campgrounds) %>;
</script>

<!-- Cluster Map Logic -->
<script src="/javascripts/clusterMap.js"></script>
